$(document).ready(function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");get_userBehavior_log("专题","客户欠费","","访问");rightControl();initStyle();initEvent();initDefaultParams();tabActive()});function rightControl(){$.ajax({url:"/cmca/home/getRight",async:false,dataType:"json",success:function(data){function fenxiRightControl(){$("#fenxiTabCon").addClass("active");if(data.khqfpmhz||data.khqfqtcd){$("#fenxiTabCon .four_nav>ul").append('<li class="col-xs-3 active" data-target="#fenxiFourNav1Con" data-toggle="tab">统计报表</li>');$("#fenxiFourNav1Con").addClass("active");if(data.khqfpmhz&&data.khqfqtcd){$("#fenxiFourNav1Con .five_nav>ul").append('<li class="active" data-target="#fenxiFourNav1FiveNav1Con" data-toggle="tab">排名汇总</li>'+'<li data-target="#fenxiFourNav1FiveNav2Con" data-toggle="tab">增量分析</li>'+'<li data-target="#fenxiFourNav1FiveNav3Con" data-toggle="tab">欠费账龄/金额分析</li>'+'<li data-target="#fenxiFourNav1FiveNav4Con" data-toggle="tab">新增原有欠费分布</li>'+'<li data-target="#fenxiFourNav1FiveNav5Con" data-toggle="tab">欠费回收</li>');$("#fenxiFourNav1FiveNav1Con").addClass("active")}else{if(data.khqfpmhz){$("#fenxiFourNav1Con .five_nav>ul").append('<li class="active" data-target="#fenxiFourNav1FiveNav1Con" data-toggle="tab">排名汇总</li>');$("#fenxiFourNav1FiveNav1Con").addClass("active")}else{if(data.khqfqtcd){$("#fenxiFourNav1Con .five_nav>ul").append('<li class="active" data-target="#fenxiFourNav1FiveNav2Con" data-toggle="tab">增量分析</li>'+'<li data-target="#fenxiFourNav1FiveNav3Con" data-toggle="tab">欠费账龄/金额分析</li>'+'<li data-target="#fenxiFourNav1FiveNav4Con" data-toggle="tab">新增原有欠费分布</li>'+'<li data-target="#fenxiFourNav1FiveNav5Con" data-toggle="tab">欠费回收</li>');$("#fenxiFourNav1FiveNav2Con").addClass("active")}}}}if(data.khqfzgwz){if(data.khqfpmhz||data.khqfqtcd){$("#fenxiTabCon .four_nav>ul").append('<li class="col-xs-3" data-target="#fenxiFourNav2Con" data-toggle="tab">审计整改问责</li>');$("#fenxiFourNav2Con .five_nav>ul").append('<li data-target="#fenxiFourNav2FiveNav1Con" data-toggle="tab">整改问责要求</li>'+'<li data-target="#fenxiFourNav2FiveNav2Con" data-toggle="tab">整改问责统计</li>')}else{$("#fenxiTabCon .four_nav>ul").append('<li class="col-xs-3 active" data-target="#fenxiFourNav2Con" data-toggle="tab">审计整改问责</li>');$("#fenxiFourNav2Con .five_nav>ul").append('<li class="active" data-target="#fenxiFourNav2FiveNav1Con" data-toggle="tab">整改问责要求</li>'+'<li data-target="#fenxiFourNav2FiveNav2Con" data-toggle="tab">整改问责统计</li>');$("#fenxiFourNav2Con,#fenxiFourNav2FiveNav1Con").addClass("active")}}if(data.khqfwjxz){if(data.khqfpmhz||data.khqfqtcd||data.khqfzgwz){$("#fenxiTabCon .four_nav>ul").append('<li class="col-xs-3" data-target="#fenxiFourNav3Con" data-toggle="tab">审计报告</li>')}else{$("#fenxiTabCon .four_nav>ul").append('<li class="col-xs-3 active" data-target="#fenxiFourNav3Con" data-toggle="tab">审计报告</li>');$("#fenxiFourNav3Con").addClass("active")}}}if(data.khqfsjjg&&(data.khqfpmhz||data.khqfqtcd||data.khqfzgwz||data.khqfwjxz)){$("#threeLvNav").append('<li class="active"><a href="#resultTabCon" id="resuleBtn" data-toggle="tab">审计结果</a></li>'+'<li><a href="#fenxiTabCon" id="fenxiBtn" data-toggle="tab">统计分析</a></li>');$("#mainLeftShow,#mainRightShow").show();$("#resultTabCon").addClass("active");$("#mainRightBtn").show();fenxiRightControl()}else{if(data.khqfpmhz||data.khqfqtcd||data.khqfzgwz||data.khqfwjxz){$("#mainRightShow").attr("style","width:100%").show();$("#threeLvNav").append('<li class="active"><a href="#fenxiTabCon" id="fenxiBtn" data-toggle="tab">统计分析</a></li>');fenxiRightControl()}else{if(data.khqfsjjg){$("#threeLvNav").append('<li class="active"><a href="#resultTabCon" id="resuleBtn" data-toggle="tab">审计结果</a></li>');$("#mainLeftShow").show();$("#mainRightShow").show();$("#resultTabCon").addClass("active");$("#mainRightBtn").show()}}}}})}function initStyle(){scroll("#contentShowWrap1","#contentShow1");scroll("#contentShowWrap2","#contentShow2");scroll("#contentShowWrap3","#contentShow3");scroll("#contentShowWrap4","#contentShow4");scroll("#wenzeQushiChartWrap","#wenzeQushiChart");scroll("#stageAccOrderWrap","#stageAccOrder");scroll("#addUpAccOrderWrap","#addUpAccOrder");scroll("#accTrendWrap","#accTrend");scroll("#fenxiFourNav1FiveNav2Con","#pubuChart");scroll("#zhanbiQushiChartWrap","#zhanbiQushiChart")}function initEvent(){$("#provinceList").on("click","li a",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");get_userBehavior_log("专题","客户欠费","区域选择","查询");$("#mapTableDialog,#TableToInfoWrap").hide();$("#chooseProvince").val($(this).text());$("#provinceListWrap").getNiceScroll(0).hide();$(this).closest(".dropdown_menu").slideUp();$("#prvdId").val($(this).attr("id").substring(1));$("#prvdNameZH").val($(this).text());tabActive()});$("#timeList").on("click","li a",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");get_userBehavior_log("专题","客户欠费","时间选择","查询");$("#mapTableDialog,#TableToInfoWrap").hide();$("#chooseTime").val($(this).text());$("#timeListWrap").getNiceScroll(0).hide();$(this).closest(".dropdown_menu").slideUp();
$("#audTrm").val($(this).attr("id").substring(1));tabActive()});$("#ProvBackBtn").on("click",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");get_userBehavior_log("专题","客户欠费","全国地图","查询");$(this).hide();$("#nanhaiQundao").show();$("#prvdId").val(10000);$("#prvdNameZH").val("全公司");drawMap();load_mapBtm_card_chart();if($("#resultTabCon").is(":visible")){load_result_chart()}else{if($("#fenxiFourNav1FiveNav1Con").is(":visible")){load_fenxi_pmhz_table()}}});$("#mapTopTabCards").on("click","li",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");var concern=$(this).attr("id");$(this).addClass("active").siblings().removeClass("active");$("#amtOrderBtn").addClass("active_btn");$("#numOrderBtn").removeClass("active_btn");$("#mapTableDialog").hide();$("#target").val("amtOrder");switch(concern){case"groupArrearsMapBtn":$("#resultTabCon .four_nav li:eq(0)").show().siblings().hide();$("#concern").val(4001);get_userBehavior_log("专题","客户欠费","集团客户欠费","查询");break;case"personArrearsMapBtn":$("#resultTabCon .four_nav li:eq(1)").show().siblings().hide();$("#concern").val(4003);get_userBehavior_log("专题","客户欠费","个人客户欠费","查询");break}drawMap();load_mapBtm_card_chart();if($("#resultTabCon").is(":visible")){load_result_chart()}});$("#threeLvNav").on("click","#resuleBtn",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");get_userBehavior_log("专题","客户欠费","审计结果","查询");$(this).addClass("active").siblings().removeClass("active");$("#groupArrearsBtn").show().siblings().hide();$("#groupArrearsMapBtn").addClass("active").next("li").removeClass("active");$("#amtOrderBtn").addClass("active_btn");$("#numOrderBtn").removeClass("active_btn");$("#concern").val(4001);$("#target").val("amtOrder");drawMap();load_result_chart();load_mapBtm_card_chart()});$("#amtOrderBtn,#numOrderBtn").on("click",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");var target=$(this).attr("id");$(this).addClass("active_btn");switch(target){case"amtOrderBtn":$("#numOrderBtn").removeClass("active_btn");$("#target").val("amtOrder");get_userBehavior_log("专题","客户欠费","欠费金额排名","查询");load_result_qfje_pm_chart();break;case"numOrderBtn":$("#amtOrderBtn").removeClass("active_btn");$("#target").val("numOrder");get_userBehavior_log("专题","客户欠费","欠费客户数量排名","查询");load_result_qfsl_pm_chart();break}drawMap();load_mapBtm_card_chart()});$("#threeLvNav").on("click","#fenxiBtn",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");get_userBehavior_log("专题","客户欠费","统计分析","查询");var activeTabPane4=$("#fenxiTabCon .four_nav li:eq(0)").attr("data-target"),activeTabPane5=$("#fenxiTabCon .five_nav:eq(0) li:eq(0)").attr("data-target");$("#fenxiTabCon .four_nav li:eq(0),#fenxiTabCon .five_nav:eq(0) li:eq(0)").addClass("active").siblings().removeClass("active");$(activeTabPane4).addClass("active").siblings().removeClass("active");$(activeTabPane5).addClass("active").siblings().removeClass("active");if($("#fenxiFourNav1FiveNav1Con").hasClass("active")){load_fenxi_pmhz_table()}else{if($("#fenxiFourNav1FiveNav2Con").hasClass("active")){load_fenxi_zlfx_chart()}else{if($("#fenxiFourNav2Con").hasClass("active")){load_fenxi_zgwz_require_table()}else{load_fenxi_sjbg_preview()}}}});$("#fenxiTabCon .four_nav ul").on("shown.bs.tab",'li[data-target="#fenxiFourNav1Con"]',function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");get_userBehavior_log("专题","客户欠费","统计报表","查询");load_fenxi_pmhz_table()});$("#fenxiFourNav1Con .five_nav ul").on("click","li",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");var dataText=$(this).attr("data-target");$(dataText).find("input").val("集团客户欠费");$("#concern").val(4001);switch(dataText){case"#fenxiFourNav1FiveNav1Con":get_userBehavior_log("专题","客户欠费","排名汇总","查询");load_fenxi_pmhz_table();break;case"#fenxiFourNav1FiveNav2Con":get_userBehavior_log("专题","客户欠费","增量分析","查询");load_fenxi_zlfx_chart();break;case"#fenxiFourNav1FiveNav3Con":get_userBehavior_log("专题","客户欠费","欠费账龄/金额分析","查询");load_fenxi_qffx_chart();break;case"#fenxiFourNav1FiveNav4Con":get_userBehavior_log("专题","客户欠费","新增原有欠费分布","查询");load_fenxi_xzyyfb_chart();break;case"#fenxiFourNav1FiveNav5Con":get_userBehavior_log("专题","客户欠费","欠费回收","查询");load_fenxi_qfhs_chart();break}});$("#COUNTForm .dropdown_list").on("click","li a",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");var inputObj=$(this).closest(".dropdown_con").find("input"),objID=inputObj.attr("id");inputObj.val($(this).text());$("#concern").val($(this).attr("data"));switch(objID){case"PMHZchooseType":get_userBehavior_log("专题","客户欠费",inputObj.val()+"排名汇总","查询");load_fenxi_pmhz_table();break;case"ZLFXchooseType":get_userBehavior_log("专题","客户欠费",inputObj.val()+"增量分析","查询");load_fenxi_zlfx_chart();break;case"XZYYFBchooseType":get_userBehavior_log("专题","客户欠费",inputObj.val()+"新增原有分布","查询");load_fenxi_xzyyfb_chart();break}});$("#fenxiTabCon .four_nav ul").on("shown.bs.tab",'li[data-target="#fenxiFourNav2Con"]',function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");get_userBehavior_log("专题","客户欠费","整改问责","查询");load_fenxi_zgwz_require_table()
});$("#fenxiFourNav2Con .five_nav ul").on("click","li",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");var dataText=$(this).attr("data-target");$(this).addClass("active").siblings().removeClass("active");switch(dataText){case"#fenxiFourNav2FiveNav1Con":get_userBehavior_log("专题","客户欠费","整改问责要求","查询");load_fenxi_zgwz_require_table();break;default:get_userBehavior_log("专题","客户欠费","整改问责统计","查询");load_fenxi_zgwz_statis_chart();break}});$("#fenxiTabCon .four_nav ul").on("shown.bs.tab",'li[data-target="#fenxiFourNav3Con"]',function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");get_userBehavior_log("专题","客户欠费","审计报告","查询");load_fenxi_sjbg_preview()});$("#sjbgDownBtn").on("click",function(){dcs.addEventCode("MAS_HP_CMCA_child_down_file_06");get_userBehavior_log("专题","客户欠费","审计报告下载","导出");down_sjbg_file()});$("#sjqdDownBtn").on("click",function(){dcs.addEventCode("MAS_HP_CMCA_child_down_file_06");get_userBehavior_log("专题","客户欠费","审计清单下载","导出");down_sjqd_file()});function mapCardShrink1(){$("#mapWrap1").removeClass("col-xs-7");$("#chinaMap").html("").addClass("map_continer1").removeClass("big_map_continer1");$("#mapTopCardContainer").removeClass("col-xs-2");$("#mapTopCardContainer .tab_item_icon").removeClass("col-xs-12").addClass("col-xs-2");$("#mapTopCardContainer .tab_item").removeClass("col-xs-12").addClass("col-xs-5");$("#cardContainer1").removeClass("col-xs-3").addClass("position_card_wrap");$("#cardContainer1 .card_item").addClass("col-xs-6").removeClass("col-xs-12");$("#cardContainer1 .card_item:even").css("paddingRight","0")}function mapCardBlowUp1(){$("#mapWrap1").addClass("col-xs-7");$("#chinaMap").html("").addClass("big_map_continer1").removeClass("map_continer1");$("#mapTopCardContainer").addClass("col-xs-2");$("#mapTopCardContainer .tab_item_icon").removeClass("col-xs-2").addClass("col-xs-12");$("#mapTopCardContainer .tab_item").removeClass("col-xs-5").addClass("col-xs-12");$("#cardContainer1").addClass("col-xs-3").removeClass("position_card_wrap");$("#cardContainer1 .card_item").addClass("col-xs-12").removeClass("col-xs-6");$("#cardContainer1 .card_item:even").css("paddingRight","15px")}$("#mainLeftBtn").on("click",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");var mapW=parseInt($("#mainLeftShow")[0].style.width);if(mapW==40){$("#mainLeftShow").hide();$("#amtOrderBtn,#numOrderBtn").closest(".btn-group").hide();$("#mainRightShow").animate({"width":"100%"},function(){tabActive()})}else{mapCardShrink1();$("#mainLeftShow").animate({"width":"40%"},function(){$("#contentTipBtn img").addClass("shrink").removeClass("blow");$("#mainRightShow").show().css("width","60%");tabActive()})}});$("#mainRightBtn").on("click",function(){dcs.addEventCode("MAS_HP_CMCA_child_query_02");var rightW=parseInt($("#mainRightShow")[0].style.width);if(rightW==60){mapCardBlowUp1();$("#contentTipBtn img").addClass("blow").removeClass("shrink");$("#mainRightShow").hide();$("#mainLeftShow").animate({"width":"100%"},function(){tabActive()})}else{$("#mainRightShow").animate({"width":"60%"},function(){$("#amtOrderBtn,#numOrderBtn").closest(".btn-group").show();$("#mainLeftShow").show().css("width","40%");tabActive()})}})}function initDefaultParams(){$.ajax({url:"/cmca/khqf/getUserPrvdId",async:false,dataType:"json",success:function(data){if(data!=10000){$("#ProvBackBtn,#nanhaiQundao").remove()}var postData={subjectId:$("#subjectId").val(),prvdId:data,time:new Date().getTime()};$.ajax({url:"/cmca/khqf/getPrvdAndAudTrmInfoData",async:false,dataType:"json",data:postData,success:function(data){$("#provinceList,#chooseTime").empty();$.each(data.prvdInfo,function(idx,prvdObj){$("#provinceList").append('<li><a href="javascript:;" id="p'+prvdObj.prvdId+'">'+prvdObj.prvdName+"</a></li>")});if(data.audTrmInfo.length>0){$.each(data.audTrmInfo,function(idx,audTrmObj){var audTrmYear=audTrmObj.audTrm.substring(0,4);var audTrmMon=parseInt(audTrmObj.audTrm.substring(4));$("#timeList").append('<li><a href="javascript:;" id="a'+audTrmObj.audTrm+'">'+audTrmYear+"年"+audTrmMon+"月</a></li>")});$("#chooseTime").val($("#timeList li:eq(0) a").text());if(data.audTrmInfo.length>0){$("#audTrm").val(data.audTrmInfo[0].audTrm)}else{$("#audTrm").val("")}}else{$("#timeList,#chooseTime,#audTrm").html("")}$("#chooseProvince").val(data.prvdInfo[0].prvdName);$("#prvdNameZH").val(data.prvdInfo[0].prvdName);$("#prvdId").val(data.prvdInfo[0].prvdId);$("#prvdNameZH").val($("#chooseProvince").val());$("#concern").val("4001");$("#target").val("amtOrder");scroll("#provinceListWrap","#provinceList");scroll("#timeListWrap","#timeList")}})}})}function tabActive(){if($("#mainLeftShow").is(":visible")){if($("#mapToTable").is(":visible")){load_qfInfo_table()}drawMap();load_mapBtm_card_chart()}if($("#mainRightShow").is(":visible")){if($("#resultTabCon").is(":visible")){load_result_chart()}else{if($("#fenxiFourNav1Con").is(":visible")){if($("#fenxiFourNav1FiveNav1Con").is(":visible")){load_fenxi_pmhz_table()}else{if($("#fenxiFourNav1FiveNav2Con").is(":visible")){load_fenxi_zlfx_chart()
}else{if($("#fenxiFourNav1FiveNav3Con").is(":visible")){load_fenxi_qffx_chart()}else{if($("#fenxiFourNav1FiveNav4Con").is(":visible")){load_fenxi_xzyyfb_chart()}else{if($("#fenxiFourNav1FiveNav5Con").is(":visible")){load_fenxi_qfhs_chart()}}}}}}else{if($("#fenxiFourNav2Con").is(":visible")){if($("#fenxiFourNav2FiveNav1Con").is(":visible")){load_fenxi_zgwz_require_table()}else{load_fenxi_zgwz_statis_chart()}}else{load_fenxi_sjbg_preview()}}}}};