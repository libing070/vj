$(document).ready(function(){initStyle();init();showProvMap()});function updateFormAndShowAllChart(paramId,paramValue){$("#"+paramId).val(paramValue);showAllChart($("#isQuanguo").val())}function updateFormAndShowBottom(paramId,paramValue){$("#"+paramId).val(paramValue);getAreaData();getAreaMonthlyData();getMisdeTop3();drawCrmVcDif()}function initStyle(){$("#table_box").niceScroll("#TableScroll",{"cursorcolor":"#847e88","cursorwidth":"6","cursorborder":"none","autohidemode":false,"nativeparentscrolling":false});$("#table_box1").niceScroll("#TableScroll1",{"cursorcolor":"#847e88","cursorwidth":"6","cursorborder":"none","autohidemode":false,"nativeparentscrolling":false});$(".zd_body").niceScroll({"cursorcolor":"#fff","cursorwidth":"6","cursorborder":"1px #fff solid","autohidemode":false});$(".yjk_table_box").niceScroll({"cursorcolor":"#fff","cursorwidth":"4","cursorborder":"none","autohidemode":false});$(".yjk_life .yjk_lifebot .yjk_lifebotimg").niceScroll({"cursorcolor":"#fff","cursorwidth":"4","cursorborder":"none","autohidemode":false});$("#sjgl").children("a").hide()}function audtrmSwitch(){$(".yangka_slider .bottom dl dd p").each(function(){$(this).addClass("disable")});$.ajax({url:$.fn.eapurl()+"/common/getAudTrm",async:false,dataType:"json",success:function(data){var yjkAudTrmList=data.yjkAudTrmList;var currentYear=$(".yangka_slider .bottom dl dt input").val().substring(0,4);$.each(yjkAudTrmList,function(idx,yjkAudTrm){if(currentYear==yjkAudTrm.substring(0,4)){for(var i=0;i<12;i++){if(PrefixInteger(i+1,2)==yjkAudTrm.substring(4,6)){$(".yangka_slider .bottom dl dd p").eq(i).removeClass("disable")}}}})}})}function init(){initDefaultParams();$(".yangka_modal .yjk_mapmodal .close_btn").click(function(){showProvMap()});$("#homepage").click(function(){window.location.href="/cmca/home/index;"});$(".yjk_Details").click(function(){var focusCd=$(this).attr("id");drawPrvdTable(focusCd);updateFormAndShowAllChart("focusCds",focusCd)});$("#smzqdbfx tbody tr:eq(0) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(1) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(2) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(3) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(4) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(5) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$(".pp").click(function(){var focusCds="1000";if("shengcheng"==$(this).attr("id")){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){if(i==1){$(this).find("span").addClass("active")}else{$(this).find("span").removeClass("active")}})});$("#smzqdbfx tbody tr:eq(0) td:gt(0)").each(function(){$(this).find("span").addClass("active")});focusCds="1001"}if("daijihuo"==$(this).attr("id")){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){$(this).find("span").removeClass("active")})});$("#smzqdbfx tbody tr:eq(1) td:gt(0)").each(function(){$(this).find("span").addClass("active")});focusCds="0000"}if("jihuo"==$(this).attr("id")){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){if(i==2){$(this).find("span").addClass("active")}else{$(this).find("span").removeClass("active")}})});$("#smzqdbfx tbody tr:eq(2) td:gt(0)").each(function(){$(this).find("span").addClass("active")});focusCds="1002,1003"}if("chongzhi"==$(this).attr("id")){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){if(i==3){$(this).find("span").addClass("active")}else{$(this).find("span").removeClass("active")}})});$("#smzqdbfx tbody tr:eq(3) td:gt(0)").each(function(){$(this).find("span").addClass("active")});focusCds="1003,1005"}if("suoding"==$(this).attr("id")){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){if(i==4){$(this).find("span").addClass("active")}else{$(this).find("span").removeClass("active")}})});$("#smzqdbfx tbody tr:eq(4) td:gt(0)").each(function(){$(this).find("span").addClass("active")});focusCds="1004"}if("qingtui"==$(this).attr("id")){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){if(i==5){$(this).find("span").addClass("active")}else{$(this).find("span").removeClass("active")}})});$("#smzqdbfx tbody tr:eq(5) td:gt(0)").each(function(){$(this).find("span").addClass("active")});focusCds="0000"}updateFormAndShowAllChart("focusCds",focusCds);$(".yjk_botleft ul li").each(function(){if($(this).text()=="关注点违规值"){var index=$(this).index();$(this).removeClass("on").siblings().addClass("on");$(".yjk_botleft .yjk_hint").eq(index).hide().siblings(".yjk_hint").show()}})});$(".yangka_checked_sheng dl").on("click","i",function(){var checkedLen=$(".yangka_checked_sheng dl dd").length;if(checkedLen==0){var text="全国";if($.trim($("#isQuanguo").val())=="false"){text=$("#provd").val()}var str='<dd><span id="10000">'+text+"</span></dd>";
$(".yangka_checked_sheng dl").append(str)}showProvMap()});$(".yangka_slider .top ul li .sheng_list dl dd p input").click(function(){prvdProvSelPrompt(this);showProvMap()});$(".yangka_slider .top ul li .dishi_list dl dd p input").click(function(){prvdCitySelPrompt(this);showProvMap()});$(".public_header .header_r_nav p.baogao a").click(function(){reportAreaShow();drawAuditReport()});$("#china").click(function(){var text="全国";var str='<dd><span id="10000">'+text+"</span></dd>";var checkedLen=$(".yangka_checked_sheng dl dd").length;for(var i=0;i<checkedLen;i++){$(".yangka_checked_sheng dl dd").eq(i).remove()}$("#prvdIds").val("10000");showAllChart($("#isQuanguo").val());if($(".yangka_checked_sheng dl dd span").attr("id")!="10000"){var checkedLen=$(".yangka_slider .top ul li .sheng_list dl dd").length;for(var i=0;i<checkedLen;i++){$(".yangka_slider .top ul li .sheng_list dl dd").eq(i).find("input").attr("checked",false)}$(".yangka_checked_sheng dl").find("dd").remove();$("#ctyIds").val("")}$(".yangka_checked_sheng dl").append(str)});$("#prov").click(function(){if($.trim($("#isQuanguo").val())!="true"){var text=$("#prov").text();var str='<dd><span id="10000">'+text+"</span></dd>";var checkedLen=$(".yangka_checked_sheng dl dd").length;for(var i=0;i<checkedLen;i++){$(".yangka_checked_sheng dl dd").eq(i).remove()}$("#ctyIds").val("10000");showAllChart($("#isQuanguo").val());if($(".yangka_checked_sheng dl dd span").attr("id")!="10000"){var checkedList=$(".yangka_slider .top ul li .dishi_list dl dd").length;for(var i=0;i<checkedList;i++){$(".yangka_slider .top ul li .dishi_list dl dd").eq(i).find("input").attr("checked",false)}$(".yangka_checked_sheng dl").find("dd").remove()}$(".yangka_checked_sheng dl").append(str)}});$(".yjk_left .yjk_ul li").click(function(){$("#attrName").val($(this).find("p span").attr("id"));showAllCharts($("#isQuanguo").val())});$(".yjk_left .yjk_detail").click(function(){$(".yjk_botleft ul li").each(function(){if($(this).text()=="关注点违规值"){var index=$(this).index();$(this).addClass("on").siblings().removeClass("on");$(".yjk_botleft .yjk_hint").eq(index).show().siblings(".yjk_hint").hide()}})});$(".yjk_left .yjk_detail h4").click(function(){$("focusCds").val("1000");updateFormAndShowAllChart("focusCds","1000");$("#smzqdbfx tbody tr:eq(0) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(1) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(2) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(3) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(4) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(5) td:gt(0)").each(function(){$(this).find("span").addClass("active")})});$(".yjk_right .yjk_item").click(function(){$(".yjk_botleft ul li").each(function(){if($(this).text()=="关注点违规值"){var index=$(this).index();$(this).removeClass("on").siblings().addClass("on");$(".yjk_botleft .yjk_hint").eq(index).hide().siblings(".yjk_hint").show()}})});$(".yjk_right").on("click",".yjk_item",function(){if($(this).find("a").find("p").attr("id")=="1001"){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){if(i==1){$(this).find("span").addClass("active")}else{$(this).find("span").removeClass("active")}})});$("#smzqdbfx tbody tr:eq(0) td:gt(0)").each(function(){$(this).find("span").addClass("active")})}if($(this).find("a").find("p").attr("id")=="1002"){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){if(i==2){$(this).find("span").addClass("active")}else{$(this).find("span").removeClass("active")}})});$("#smzqdbfx tbody tr:eq(2) td:gt(0)").each(function(){$(this).find("span").addClass("active")})}if($(this).find("a").find("p").attr("id")=="1003"){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){if(i==2||i==3){$(this).find("span").addClass("active")}else{$(this).find("span").removeClass("active")}})});$("#smzqdbfx tbody tr:eq(2) td:gt(0)").each(function(){$(this).find("span").addClass("active")});$("#smzqdbfx tbody tr:eq(3) td:gt(0)").each(function(){$(this).find("span").addClass("active")})}if($(this).find("a").find("p").attr("id")=="1005"){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){if(i==3){$(this).find("span").addClass("active")}else{$(this).find("span").removeClass("active")}})});$("#smzqdbfx tbody tr:eq(3) td:gt(0)").each(function(){$(this).find("span").addClass("active")})}if($(this).find("a").find("p").attr("id")=="1004"){$("#smzqdbfx tbody tr").each(function(){$(this).find("td").each(function(i){if(i==4){$(this).find("span").addClass("active")}else{$(this).find("span").removeClass("active")}})});$("#smzqdbfx tbody tr:eq(4) td:gt(0)").each(function(){$(this).find("span").addClass("active")})}});$(".yjk_bottom .yjk_botright .yjk_brul li.yjk_dh").click(function(){getAreaData()});$(".header .nav p.baogao a").click(function(){reportAreaShow();
drawAuditReport()});$("#yjkReportDownload").click(function(){zdconfirm("确认下载审计报告吗？",function(r){if(r){var prvdId="10000";if($.trim($("#isQuanguo").val())=="false"){prvdId=$("#prvdIds").val()}window.location=$.fn.eapurl()+"/base/downfiles?audTrm="+$("#audTrm").val()+"&subjectId="+$("#subjectId").val()+"&prvdId="+prvdId+"&fileType=audReport";var path=$.fn.eapurl()+"/base/downfiles?audTrm="+$("#audTrm").val()+"&subjectId="+$("#subjectId").val()+"&prvdId="+prvdId+"&fileType=audReport";$.ajax({url:$.fn.eapurl()+"/sjbg/updateWorkFileDownCount",async:false,dataType:"json",data:{downUrl:path},success:function(data){}})}})});$("#yjkDetailDownload").click(function(){zdconfirm("确认下载审计明细清单吗？",function(r){if(r){var prvdId="10000";if($.trim($("#isQuanguo").val())=="false"){prvdId=$("#prvdIds").val()}window.location=$.fn.eapurl()+"/base/downfiles?audTrm="+$("#audTrm").val()+"&subjectId="+$("#subjectId").val()+"&prvdId="+prvdId+"&fileType=audDetail";var path=$.fn.eapurl()+"/base/downfiles?audTrm="+$("#audTrm").val()+"&subjectId="+$("#subjectId").val()+"&prvdId="+prvdId+"&fileType=audDetail";$.ajax({url:$.fn.eapurl()+"/sjbg/updateWorkFileDownCount",async:false,dataType:"json",data:{downUrl:path},success:function(data){}})}})})}function prvdCitySelPrompt(thisObj){var checked=$(thisObj).is(":checked");if(checked){var text=$(thisObj).parent().siblings("span").text();var str='<dd><span id="'+$(thisObj).val()+'">'+text+'</span><i class="icon icon-remove"></i></dd>';var checkedLen=$(".yangka_checked_sheng dl dd").length;for(var i=0;i<checkedLen;i++){if($(".yangka_checked_sheng dl dd").eq(i).find("span").attr("id")=="10000"){$(".yangka_checked_sheng dl dd").eq(i).remove()}}$(".yangka_checked_sheng dl").append(str)}else{var text=$(thisObj).parent().siblings("span").text();var checkedLen=$(".yangka_checked_sheng dl dd").length;for(var i=0;i<checkedLen;i++){if($(".yangka_checked_sheng dl dd").eq(i).find("span").text().indexOf(text)>-1){$(".yangka_checked_sheng dl dd").eq(i).remove()}}checkedLen=$(".yangka_checked_sheng dl dd").length;if(checkedLen==0){var text=$("#prov").text();var str='<dd><span id="10000">'+text+"</span></dd>";$(".yangka_checked_sheng dl").append(str)}}}function initDefaultParams(){var prvdIds=$.fn.GetQueryString("prvdIds");$.ajax({url:$.fn.eapurl()+"/yjk/queryDefaultParams",async:false,dataType:"json",data:{prvdIds:prvdIds},success:function(data){$("#audTrm").val(data["audTrm"]);$("#prvdIds").val(data["prvdIds"]);$("#ctyIds").val(data["ctyIds"]);$("#attrName").val(data["attrName"]);$("#focusCds").val(data["focusCds"]);$("#isQuanguo").val($.trim(data["isQuanguo"]));var text="全国";if($.trim(data["isQuanguo"])=="true"){$("#cityLi").attr("style","display:none;");$("#china").attr("style","display:block;");$("#prov").empty().append("省公司")}else{text=data["provCName"];$("#ctyIds").val("10000");queryCityList(data["prvdIds"]);$("#provName").val(data["provName"]);$("#provd").val(data["provCName"]);$("#cityLi").attr("style","display:block;");$("#prov").empty().append(data["provCName"]);$("#china").attr("style","display:none;");$(".yangka_slider .top ul li[id='provLi']").hover(function(){$(".yangka_slider .top ul li").removeClass("active")})}var str='<dd><span id="10000">'+text+"</span></dd>";$(".yangka_checked_sheng dl").append(str);var yearStr=data["yearStr"];var yearList=yearStr.split(",");$(".yangka_slider .bottom dl dt p span.up").click(function(){var value=$(".yangka_slider .bottom dl dt input").val().substring(0,4);value=parseInt(value);for(var i=yearList.length-1;i>-1;i--){if(yearList[i]==value){i--;if(i>-1){value=yearList[i];break}else{return}}}var str=value+"年";$(".yangka_slider .bottom dl dt input").val(str);$(".yangka_slider .bottom dl dt input").attr("alt",value);audtrmSwitch();var monthValue1="";for(var k=11;k>=0;k--){if(!$(".yangka_slider .bottom dl dd p").eq(k).hasClass("disable")){$(".yangka_slider .bottom dl dd p").eq(k).addClass("active").siblings().removeClass("active");monthValue1=k+1;$("#month_active").val(PrefixInteger(monthValue1,2));changeDateShowChart();break}}$("#q1-s1").slider({orientation:"vertical",range:"min",value:(13-monthValue1),min:1,max:12})});$(".yangka_slider .bottom dl dt p span.down").click(function(){var value=$(".yangka_slider .bottom dl dt input").val().substring(0,4);value=parseInt(value);for(var i=0;i<yearList.length;i++){if(yearList[i]==value){i++;if(i<yearList.length){value=yearList[i];break}else{return}}}var str=value+"年";$(".yangka_slider .bottom dl dt input").val(str);$(".yangka_slider .bottom dl dt input").attr("alt",value);audtrmSwitch();var monthValue1="";for(var k=11;k>=0;k--){if(!$(".yangka_slider .bottom dl dd p").eq(k).hasClass("disable")){$(".yangka_slider .bottom dl dd p").eq(k).addClass("active").siblings().removeClass("active");monthValue1=k+1;$("#month_active").val(PrefixInteger(monthValue1,2));changeDateShowChart();break}}$("#q1-s1").slider({orientation:"vertical",range:"min",value:(13-monthValue1),min:1,max:12})});var currentDate=$("#audTrm").val();$(".yangka_slider .bottom dl dt input").val(currentDate.substring(0,4)+"年");
$(".yangka_slider .bottom dl dt input").attr("alt",currentDate.substring(0,4));audtrmSwitch();var currentM=currentDate.substring(4,6);$("#month_active").val(currentM);$("#checkDate").empty().append($("#year").attr("alt")+"."+$("#month_active").val()+" <span></span>");var str=$("#year").val()+parseInt($("#month_active").val())+"月有价卡管理违规";$("#tableTitle").empty().append(str);$(".yangka_slider .bottom dl dd p").eq(parseInt($("#month_active").val())-1).addClass("active").siblings().removeClass("active");var monthValue;$("#q1-s1").slider({orientation:"vertical",range:"min",value:13-parseInt($("#month_active").val()),min:1,max:12,slide:function(){monthValue=parseInt($("#month_active").val())},stop:function(event,ui){$("#month_active").val(PrefixInteger(13-parseInt(ui.value),2));var monthActive=parseInt($("#month_active").val())-1;if($(".yangka_slider .bottom dl dd p").eq(monthActive).hasClass("disable")){$("#q1-s1").slider({orientation:"vertical",range:"min",value:(13-monthValue),min:1,max:12});$("#month_active").val(PrefixInteger(monthValue,2))}else{$(".yangka_slider .bottom dl dd p").eq(monthActive).addClass("active").siblings().removeClass("active")}changeDateShowChart()}})}})}function showProvMap(){var checkedLen=$(".yangka_checked_sheng dl dd").length;if($.trim($("#isQuanguo").val())=="true"){if($(".yangka_checked_sheng dl dd").eq(0).find("span").text().indexOf("全国")>-1){$("#prvdIds").val("10000");$("#ctyIds").val("")}else{if(checkedLen>0){var prvdIds="";for(var i=0;i<checkedLen;i++){prvdIds+=$(".yangka_checked_sheng dl dd").eq(i).find("span").attr("id")+","}$("#prvdIds").val(prvdIds.substring(0,prvdIds.length-1));$("#ctyIds").val("")}}$("#prvdIds_temp").val($("#prvdIds").val())}else{if($(".yangka_checked_sheng dl dd").eq(0).find("span").attr("id")=="10000"){$("#ctyIds").val("10000")}else{if(checkedLen>0){var ctyIds="";for(var i=0;i<checkedLen;i++){ctyIds+=$(".yangka_checked_sheng dl dd").eq(i).find("span").attr("id")+","}$("#ctyIds").val(ctyIds.substring(0,ctyIds.length-1))}}}showAllChart($("#isQuanguo").val())}function changeDateShowChart(){$("#audTrm").val($("#year").attr("alt")+""+$("#month_active").val());$("#checkDate").empty().append($("#year").attr("alt")+"."+$("#month_active").val()+" <span></span>");var str=$("#year").val()+parseInt($("#month_active").val())+"月有价卡管理违规";$("#tableTitle").empty().append(str);showAllChart($("#isQuanguo").val())}function showAllChart(isQuanguo){if($.trim(isQuanguo)=="true"){drawChinaMapChart()}else{drawProvMapChart()}getAreaData();getAreaMonthlyData();getSummaryData();getMisdeTop3();drawCrmVcDif()}function showAllCharts(isQuanguo){if($.trim(isQuanguo)=="true"){drawChinaMapChart()}else{drawProvMapChart()}getAreaData();getAreaMonthlyData();getMisdeTop3()}function getMisdeTop3(){if($("#focusCds").val()=="1000"){getMisdeTop3OfFoc()}else{getMisneTop3ForThin()}}function getSummaryData(){var postData={};postData.prvdIds=$("#prvdIds").val();postData.ctyIds=$("#ctyIds").val();postData.focusCds=$("#focusCds").val();postData.audTrm=$("#audTrm").val();postData.attrName=$("#attrName").val();$.ajax({url:$.fn.eapurl()+"/yjk/getSummaryData",dataType:"json",data:postData,success:function(data){drawSummaryTopic(data)}})}function drawSummaryTopic(jsonData){$("#qtyPercent").empty().append(jsonData.qtyPercent+"%");$("#errPercent").empty().append(jsonData.errPercent+"%");$("#errQty").empty().append(formatCurrency(jsonData.errQty,false));$("#errAmt").empty().append(formatCurrency(jsonData.errAmt,false));if(jsonData.qtyPerUpdown==0){$("#qtyPerUpdown").css("visibility","hidden")}else{if(jsonData.qtyPerUpdown<0){$("#qtyPerUpdown").attr("src","/cmca/resource/images/youjiaka/down.png");$("#qtyPerUpdown").css("visibility","visible")}else{$("#qtyPerUpdown").attr("src","/cmca/resource/images/youjiaka/top.png");$("#qtyPerUpdown").css("visibility","visible")}}if(jsonData.amtPerUpdown==0){$("#amtPerUpdown").css("visibility","hidden")}else{if(jsonData.amtPerUpdown<0){$("#amtPerUpdown").attr("src","/cmca/resource/images/youjiaka/down.png");$("#amtPerUpdown").css("visibility","visible")}else{$("#amtPerUpdown").attr("src","/cmca/resource/images/youjiaka/top.png");$("#amtPerUpdown").css("visibility","visible")}}if(jsonData.qtyUpdown==0){$("#qtyUpDown2").css("visibility","hidden")}else{if(jsonData.qtyUpdown<0){$("#qtyUpDown2").attr("src","/cmca/resource/images/youjiaka/down.png");$("#qtyUpDown2").css("visibility","visible")}else{$("#qtyUpDown2").attr("src","/cmca/resource/images/youjiaka/top.png");$("#qtyUpDown2").css("visibility","visible")}}if(jsonData.amtUpdown==0){$("#amtUpdown").css("visibility","hidden")}else{if(jsonData.amtUpdown<0){$("#amtUpdown").attr("src","/cmca/resource/images/youjiaka/down.png");$("#amtUpdown").css("visibility","visible")}else{$("#amtUpdown").attr("src","/cmca/resource/images/youjiaka/top.png");$("#amtUpdown").css("visibility","visible")}}}function getAreaMonthlyData(){var jsonData;var postData={};postData.prvdIds=$("#prvdIds").val();postData.ctyIds=$("#ctyIds").val();postData.focusCds=$("#focusCds").val();
postData.audTrm=$("#audTrm").val();postData.attrName=$("#attrName").val();$.ajax({url:$.fn.eapurl()+"/yjk/getAreaMonthlyData",dataType:"json",data:postData,success:function(data){drawAreaMonthlyBarChart(data)}});return jsonData}function drawAreaMonthlyBarChart(jsonData){Highcharts.setOptions({colors:["#146869"]});$("#areaMonthlyBarChart").highcharts({chart:{backgroundColor:"rgba(0,0,0,0)"},title:{text:""},xAxis:{categories:jsonData.categories,labels:{style:{color:"#FFFFFF",fontWeight:"bold"},step:2},gridLineColor:"#6d7484",gridLineWidth:1},yAxis:{min:0,title:{text:""},lineColor:"#6d7484",lineWidth:1,plotLines:[{value:0,width:1,color:"#808080"}],labels:{formatter:function(){if(jsonData.attrName.indexOf("Percent")>-1){return this.value+"%"}else{if(this.value>=10000000&&this.value%10000==0){return this.value/100000000+"亿"}else{if(this.value>=10000&&this.value%10000==0){return this.value/10000+"万"}else{if(this.value>=1000&&this.value%1000==0){return this.value/1000+"千"}else{return this.value}}}}},style:{color:"#FFFFFF",fontWeight:"bold"}},gridLineColor:"#6d7484",gridLineWidth:1},tooltip:{formatter:function(){var attrName="";var attrPer="";if("qtyPercent"==jsonData.attrName){attrName="违规数量比";attrPer="%"}if("errPercent"==jsonData.attrName){attrName="违规金额比";attrPer="%"}if("errQty"==jsonData.attrName){attrName="违规数量";this.y=formatCurrency(this.y,false);attrPer="张"}if("errAmt"==jsonData.attrName){attrName="违规金额";this.y=formatCurrency(this.y,false);attrPer=" 元"}return"<b>"+this.x+"</b><br/>"+"有价卡"+attrName+"："+this.y+attrPer+"<br/>"}},legend:{enabled:false},plotOptions:{spline:{marker:{enabled:true}}},series:jsonData.series})}function getAreaData(){var jsonData;var postData={};postData.prvdIds=$("#prvdIds").val();postData.ctyIds=$("#ctyIds").val();postData.focusCds=$("#focusCds").val();postData.audTrm=$("#audTrm").val();postData.attrName=$("#attrName").val();$.ajax({url:$.fn.eapurl()+"/yjk/getAreaData",dataType:"json",data:postData,success:function(data){if("1001"==$("#focusCds").val()){Highcharts.setOptions({colors:["#106d45"]})}if("1002"==$("#focusCds").val()){Highcharts.setOptions({colors:["#29a195"]})}if("1003"==$("#focusCds").val()){Highcharts.setOptions({colors:["#316b9c"]})}if("1005"==$("#focusCds").val()){Highcharts.setOptions({colors:["#686abc"]})}if("1004"==$("#focusCds").val()){Highcharts.setOptions({colors:["#53467c"]})}if("1002,1003"==$("#focusCds").val()){Highcharts.setOptions({colors:["#316b9c","#29a195"]})}if("1003,1005"==$("#focusCds").val()){Highcharts.setOptions({colors:["#686abc","#316b9c"]})}if("1000"==$("#focusCds").val()){Highcharts.setOptions({colors:["#686abc","#53467c","#316b9c","#29a195","#106d45"]})}drawAreaBarChart(data)}});return jsonData}function drawAreaBarChart(jsonData){if(jsonData.categories==undefined){$("#areaBarChart").attr("style","vertical-align: bottom;transform: translate3d(0px, 0px, 0px);width: 715px;height: 156px;")}else{$("#areaBarChart").attr("style","vertical-align: bottom;transform: translate3d(0px, 0px, 0px);width: 715px;height: 156px;min-height:"+jsonData.categories.length*20+"%")}var emptyFlag=0;if("0000"==$("#focusCds").val()){emptyFlag=1}$("#areaBarChart").highcharts({chart:{type:"bar",backgroundColor:"rgba(0,0,0,0)",width:1900},title:{text:""},xAxis:{categories:jsonData.categories,crosshair:true,min:0,showEmpty:true,labels:{style:{color:"#FFFFFF"},},gridLineColor:"#6d7484",gridLineWidth:1},yAxis:{lineColor:"#6d7484",tickPixelInterval:40,showEmpty:true,lineWidth:1,plotLines:[{value:0,width:1,color:"#808080"}],min:0,title:{text:""},labels:{step:2,formatter:function(){if(jsonData.attrName.indexOf("Percent")>-1){return this.value+"%"}else{if(this.value>=1000000){this.value=this.value/1000000+"百万"}if(this.value>=10000){this.value=this.value/10000+"万"}return this.value}},style:{color:"#FFFFFF",fontWeight:"bold"},},gridLineColor:"#6d7484",gridLineWidth:1},legend:{enabled:emptyFlag==1?false:true,reversed:true,verticalAlign:"top",borderWidth:0,itemStyle:{"color":"#fff","cursor":"default","fontSize":"11px","fontWeight":"bold"},itemHoverStyle:{color:"#FFF"},x:0,y:-8},tooltip:{formatter:function(){var attrName="";var attrPer="";if("qtyPercent"==jsonData.attrName){attrName="违规数量比";attrPer="%"}if("errPercent"==jsonData.attrName){attrName="违规金额比";attrPer="%"}if("errQty"==jsonData.attrName){attrName="违规数量";this.y=formatCurrency(this.y,false);attrPer="张"}if("errAmt"==jsonData.attrName){attrName="违规金额";this.y=formatCurrency(this.y,false);attrPer=" 元"}if(emptyFlag==1){return"<b>"+this.x+"</b><br/>"+" 有价卡"+attrName+"："+this.y+attrPer+"<br/>"}else{return"<b>"+this.x+"</b><br/>"+this.series.name+" 有价卡"+attrName+"："+this.y+attrPer+"<br/>"}}},plotOptions:{bar:{pointPadding:0.2,pointWidth:10,groupPadding:0.4,borderColor:"rgba(0,0,0,0)",borderWidth:0},series:{dataLabels:{enabled:true,verticalAlign:"top",formatter:function(){var yVal=this.y;return yVal},style:{fontSize:24,color:"rgba(0,0,0,0)",textShadow:"0px 0px 0px 0px"}},events:{legendItemClick:function(event){return false}},stacking:"normal",pointPadding:4,pointWidth:15}},series:jsonData.series});
$(".yjk_botrightimg").niceScroll({"cursorcolor":"#fff","cursoropacitymin":1,"cursoropacitymax":1,"cursorwidth":"10","cursorborder":"2px #000 solid","zIndex":99999,"autohidemode":false})}function drawChinaMapChart(){$("#nanhaizhudao").attr("style","display:block;position: absolute;bottom: 10px;right: 179px;");var postData={};postData.audTrm=$("#audTrm").val();postData.prvdIds=$("#prvdIds").val();postData.ctyIds=$("#ctyIds").val();postData.focusCds=$("#focusCds").val();postData.attrName=$("#attrName").val();var text="违规金额";if($("#attrName").val()=="qtyPercent"){text="违规数量占比"}else{if($("#attrName").val()=="errQty"){text="违规数量"}else{if($("#attrName").val()=="errPercent"){text="违规金额占比"}}}$("#legendDescrib").empty().append("注：根据"+text+"违规程度展示风险级别：红色：排名前3名；橙色：排名4-10名；绿色：排名10名之后和无违规");var mapData=$.fn.chinaMapData();$.ajax({url:$.fn.eapurl()+"/yjk/getMap",data:postData,dataType:"json",success:function(data){var body=data.body;$.each(mapData,function(i,map){var pnm=this.name.toUpperCase();var id=this.properties.id;var values=body.values;var regionName="XXX";var errQty="-1";var qtyPercent="-1";var errAmt="-1";var errPercent="-1";var rank="-1";var isShow=false;$.each(values,function(idx,obj){if(id==obj.areaId){errQty=obj.errQty;qtyPercent=obj.qtyPercent;errAmt=obj.errAmt;errPercent=obj.errPercent;rank=obj.rank;isShow=true}});if((!isShow&&postData.prvdIds!=10000)){this.properties.name="";this.color="rgba(255,255,255,0)"}else{map.properties.trueValue=errQty}this.properties.errQtyValue=errQty;this.properties.qtyPercentValue=qtyPercent;this.properties.errAmtValue=errAmt;this.properties.errPercentValue=errPercent;if(errQty!="0"&&errAmt!="0"){map.value=rank}else{map.value="9999"}});var rankList=$.fn.colorTopAxis();Highcharts.setOptions({lang:{drillUpText:'<span style="cursor:pointer">返回</span>'}});$("#chinaMap").highcharts("Map",{chart:{events:{drillup:function(){$("#prvdIds").val($("#prvdIds_temp").val());$("#ctyIds").val("");showAllChart($("#isQuanguo").val());$("#nanhaizhudao").attr("style","display:block;position: absolute;bottom: 10px;right: 179px;")},drilldown:function(e){if("xianggang"==e.point.drilldown||"taiwan"==e.point.drilldown||"aomen"==e.point.drilldown){return}if($(".yangka_checked_sheng dl dd").find("span").text().indexOf("全国")>-1){}else{var checkedLen=$(".yangka_checked_sheng dl dd").length;var checkedFlag=0;if(checkedLen>0){for(var i=0;i<checkedLen;i++){if(e.point.properties["id"]==$(".yangka_checked_sheng dl dd").eq(i).find("span").attr("id")){checkedFlag=1;break}}if(checkedFlag==0){for(var i=0;i<$(".yangka_slider .top ul li .sheng_list dl dd").length;i++){if($(".yangka_slider .top ul li .sheng_list dl dd").eq(i).find("span").text().indexOf(e.point.properties["cnname"])>-1){$(".yangka_slider .top ul li .sheng_list dl dd").eq(i).find("input").attr("checked",true);break}}var text=e.point.properties["cnname"];var str='<dd><span id="'+e.point.properties["id"]+'">'+text+'</span><i class="icon icon-remove"></i></dd>';var checkedLen=$(".yangka_checked_sheng dl dd").length;$(".yangka_checked_sheng dl").append(str);showProvMap();return}}}$("#nanhaizhudao").attr("style","display:none;");if(!e.seriesOptions){var chart=this;var name=e.point.properties["name"];$.ajax({type:"GET",url:$.fn.eapurl()+"/resource/js/highcharts/maps/"+e.point.drilldown+".geo.json",contentType:"application/json; charset=utf-8",dataType:"json",success:function(json){var cityData;var postCityData={};postCityData.audTrm=postData.audTrm;postCityData.prvdIds=e.point.properties["id"];postCityData.ctyIds="10000";postCityData.attrName=postData.attrName;postCityData.focusCds=postData.focusCds;var cityData="";$.ajax({url:$.fn.eapurl()+"/yjk/getMap",async:false,dataType:"json",data:postCityData,success:function(data){cityData=data}});var mapData=Highcharts.geojson(json);$.each(mapData,function(i,map){var code=map.properties.code;var cnname=map.properties.name;var body=cityData.body;var values=body.values;var regionName="XXX";var errQty="-1";var qtyPercent="-1";var errAmt="-1";var errPercent="-1";var rank="-1";$.each(values,function(idx,obj){if(code==obj.areaId){errQty=obj.errQty;qtyPercent=obj.qtyPercent;errAmt=obj.errAmt;errPercent=obj.errPercent;rank=obj.rank}});map.properties.trueValue=errQty;if(errQty!="0"&&errAmt!="0"){map.value=rank}else{map.value="9999"}map.properties.errQtyValue=errQty;map.properties.qtyPercentValue=qtyPercent;map.properties.errAmtValue=errAmt;map.properties.errPercentValue=errPercent});var rankList=$.fn.colorTopAxis();$("#prvdIds_temp").val($("#prvdIds").val());$("#prvdIds").val(e.point.properties["id"]);$("#ctyIds").val("10000");getAreaData();getAreaMonthlyData();getSummaryData();getMisdeTop3();drawCrmVcDif();chart.hideLoading();chart.addSeriesAsDrilldown(e.point,{borderColor:"#6d7484",name:e.point.cnname,data:mapData,dataLabels:{color:"#000",enabled:true,allowOverlap:true,style:{fontSize:12,textShadow:"0px 0px 0px 0px"},formatter:function(){if(this.point.name=="安阳"){this.point.plotY=this.point.plotY-25}if(this.point.name=="塔城"){this.point.plotY=this.point.plotY-25
}if(this.point.name=="十堰"){this.point.plotY=this.point.plotY+33}if(this.point.name=="中卫"){this.point.plotX=this.point.plotX+30}if(this.point.name=="益阳"){this.point.plotY=this.point.plotY+25}if(this.point.name=="鹤岗"){this.point.plotY=this.point.plotY+10}if(this.point.name=="无锡"){this.point.plotX=this.point.plotX+27}if(this.point.name=="上饶"){this.point.plotX=this.point.plotX+35;this.point.plotY=this.point.plotY+12}if(this.point.name=="泸州"){this.point.plotX=this.point.plotX-23;this.point.plotY=this.point.plotY-12}if(this.point.name=="百色"){this.point.plotX=this.point.plotX+35;this.point.plotY=this.point.plotY+12}if(this.point.name=="辽阳"){this.point.plotX=this.point.plotX+27;this.point.plotY=this.point.plotY+28}return this.point.name}}})},error:function(XMLHttpRequest,textStatus,errorThrown){}})}}},backgroundColor:"rgba(0,0,0,0)",animation:true},title:{text:""},subtitle:{text:"",floating:true,align:"right",y:60,x:-10,style:{fontSize:"14px"}},colorAxis:{dataClasses:rankList},tooltip:{formatter:function(){var pnm=this.point.name.toUpperCase();if(pnm=="TAIWAN"||pnm=="HONGKONG"||pnm=="MACAU"){return"没有数据"}var name=this.point.properties.name;var cityName=this.point.properties.cnname;if(name==null||name==""){$("#chinaMap").find('g[class="highcharts-tooltip"]').find("text").parent().attr("style","display:none");return""}else{if(cityName==null||cityName==""){cityName=this.point.properties.name}$("#chinaMap").find('g[class="highcharts-tooltip"]').find("text").parent().attr("style","display:block")}var trueValue=this.point.properties.trueValue;var returnVal="<b>"+cityName+"</b>";if(trueValue=="-1"){return returnVal=returnVal+"<br/>没有数据"}return"<b>"+cityName+"</b><br/>有价卡违规数量<b>"+formatCurrency(this.point.properties.errQtyValue,false)+"</b>张，占比<b>"+this.point.properties.qtyPercentValue+"</b>；违规金额<b>"+formatCurrency(this.point.properties.errAmtValue,false)+"</b>元，占比<b>"+this.point.properties.errPercentValue+"</b>"}},plotOptions:{map:{states:{hover:{color:"#FFF"}},events:{legendItemClick:function(){return false}}}},legend:{layout:"horizontal",backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(0,0,0,0)",borderWidth:0,itemHoverStyle:{color:"#FFFFFF"},itemStyle:{"color":"#fff","cursor":"pointer","fontSize":"12px","fontWeight":"bold"}},series:[{borderColor:"#6d7484",data:mapData,name:"全国",dataLabels:{enabled:true,allowOverlap:true,style:{fontSize:12,textShadow:"0px 0px 0px 0px"},formatter:function(){if(this.point.properties.cnname=="澳门"){this.point.plotY=this.point.plotY+10}return this.point.properties.cnname}}}],drilldown:{activeDataLabelStyle:{textDecoration:"none"}}})}})}function drawProvMapChart(){$("#nanhaizhudao").attr("style","display:none;position: absolute;bottom: 10px;right: 179px;");var postData={};postData.audTrm=$("#audTrm").val();postData.prvdIds=$("#prvdIds").val();postData.ctyIds=$("#ctyIds").val();postData.attrName=$("#attrName").val();postData.focusCds=$("#focusCds").val();var provName=$("#provName").val();var text="违规金额";if($("#attrName").val()=="qtyPercent"){text="违规数量占比"}else{if($("#attrName").val()=="errQty"){text="违规数量"}else{if($("#attrName").val()=="errPercent"){text="违规金额占比"}}}$("#legendDescrib").empty().append("注：根据"+text+"违规程度展示风险级别：红色：排名前3名；橙色：排名4-10名；绿色：排名10名之后和无违规");$.ajax({type:"GET",url:$.fn.eapurl()+"/resource/js/highcharts/maps/"+provName.toLowerCase()+".geo.json",contentType:"application/json; charset=utf-8",dataType:"json",async:false,success:function(json){var cityData="";$.ajax({url:$.fn.eapurl()+"/yjk/getMap",async:false,dataType:"json",data:postData,success:function(data){cityData=data}});var mapData=Highcharts.geojson(json);$.each(mapData,function(i,map){var code=map.properties.code;var cnname=map.properties.name;var body=cityData.body;var values=body.values;var errQty="-1";var qtyPercent="-1";var errAmt="-1";var errPercent="-1";var rank="-1";var isShow=false;$.each(values,function(idx,obj){if(code==obj.areaId){errQty=obj.errQty;qtyPercent=obj.qtyPercent;errAmt=obj.errAmt;errPercent=obj.errPercent;rank=obj.rank;isShow=true}});if($("#ctyIds").val().indexOf(code)>=0){isShow=true}if((!isShow&&$("#ctyIds").val()!=10000)){this.color="rgba(255,255,255,0)"}else{map.properties.trueValue=errQty}if(errQty!="0"&&errAmt!="0"){map.value=rank}else{map.value="9999"}map.properties.errQtyValue=errQty;map.properties.qtyPercentValue=qtyPercent;map.properties.errAmtValue=errAmt;map.properties.errPercentValue=errPercent});var rankList=$.fn.colorTopAxis();$("#chinaMap").highcharts("Map",{chart:{events:{},backgroundColor:"rgba(0,0,0,0)"},title:{text:""},subtitle:{text:"",floating:true,align:"right",y:60,x:-10,style:{fontSize:"14px"}},colorAxis:{dataClasses:rankList},tooltip:{formatter:function(){var cityName=this.point.properties.name;if($(".yangka_checked_sheng dl dd").find("span").attr("id")=="10000"){}else{var obj=this.point;var checkedLen=$(".yangka_checked_sheng dl dd").length;var checkedFlag=0;if(checkedLen>0){for(var i=0;i<checkedLen;i++){if($(".yangka_checked_sheng dl dd").eq(i).find("span").attr("id").indexOf(obj.properties["code"])>=0){checkedFlag=1;
break}}if(checkedFlag==0){$("#chinaMap").find('g[class="highcharts-tooltip"]').find("text").parent().attr("style","display:none");return""}else{$("#chinaMap").find('g[class="highcharts-tooltip"]').attr("style","display:block")}}}var trueValue=this.point.properties.trueValue;var returnVal="<b>"+cityName+"</b>";if(trueValue=="-1"){return returnVal=returnVal+"<br/>没有数据"}return"<b>"+cityName+"</b><br/>有价卡违规数量<b>"+formatCurrency(this.point.properties.errQtyValue,false)+"</b>张，占比<b>"+this.point.properties.qtyPercentValue+"</b>；违规金额<b>"+formatCurrency(this.point.properties.errAmtValue,false)+"</b>元，占比<b>"+this.point.properties.errPercentValue+"</b>"}},plotOptions:{map:{cursor:"pointer",states:{hover:{color:"#E5FEFF"}}}},legend:{layout:"horizontal",backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(0,0,0,0)",borderWidth:0,itemHoverStyle:{color:"#FFFFFF"},itemStyle:{"color":"#fff","cursor":"pointer","fontSize":"12px","fontWeight":"bold"}},series:[{events:{click:function(e){if($(".yangka_checked_sheng dl dd").find("span").attr("id")=="10000"){}else{var obj=e.point;var checkedLen=$(".yangka_checked_sheng dl dd").length;var checkedFlag=0;if(checkedLen>0){for(var i=0;i<checkedLen;i++){if(obj.properties["code"]==$(".yangka_checked_sheng dl dd").eq(i).find("span").attr("id")){checkedFlag=1;break}}if(checkedFlag==0){for(var i=0;i<$(".yangka_slider .top ul li .dishi_list dl dd").length;i++){if($(".yangka_slider .top ul li .dishi_list dl dd").eq(i).find("span").text().indexOf(obj.properties["name"])>-1){$(".yangka_slider .top ul li .dishi_list dl dd").eq(i).find("input").attr("checked",true);break}}var text=obj.properties["name"];var str='<dd><span id="'+obj.properties["code"]+'">'+text+'</span><i class="icon icon-remove"></i></dd>';var checkedLen=$(".yangka_checked_sheng dl dd").length;$(".yangka_checked_sheng dl").append(str);showProvMap();return}}}}},borderColor:"#6d7484",data:mapData,name:provName,dataLabels:{color:"#0d233a",enabled:true,allowOverlap:true,formatter:function(){if(this.point.name=="安阳"||this.point.name=="塔城"){this.point.plotY=this.point.plotY-25;this.point.plotX=this.point.plotX-15}if(this.point.name=="十堰"){this.point.plotY=this.point.plotY+33}if(this.point.name=="益阳"){this.point.plotY=this.point.plotY+25}if(this.point.name=="鹤岗"){this.point.plotY=this.point.plotY+10}if(this.point.name=="无锡"){this.point.plotX=this.point.plotX+27}if(this.point.name=="上饶"){this.point.plotX=this.point.plotX+35;this.point.plotY=this.point.plotY+12}if(this.point.name=="泸州"){this.point.plotX=this.point.plotX-23;this.point.plotY=this.point.plotY-12}if(this.point.name=="百色"){this.point.plotX=this.point.plotX+35;this.point.plotY=this.point.plotY+12}if(this.point.name=="辽阳"){this.point.plotX=this.point.plotX+27;this.point.plotY=this.point.plotY+28}return this.point.name},style:{fontSize:12,textShadow:"0px 0px 0px 0px"}}}]})}})}function getMisdeTop3OfFoc(){var postData={};postData.audTrm=$("#audTrm").val();postData.prvdIds=$("#prvdIds").val();postData.ctyIds=$("#ctyIds").val();postData.attrName=$("#attrName").val();$.ajax({url:$.fn.eapurl()+"/yjk/getMisdeTop3OfFoc",dataType:"json",data:postData,success:function(data){var wgzStr="";var columns=data.body.columns;$.each(columns,function(idx,obj){wgzStr+="<p>"+obj.focusName+"  <span>"+comdify(obj.errorCount);if(obj.errorPercent<0){wgzStr+='<img src="/cmca/resource/images/youjiaka/down.png" alt="" class="down">'}else{wgzStr+='<img src="/cmca/resource/images/youjiaka/top.png" alt="" class="top">'}wgzStr+="</span>  </p>"});$("#gzdwgz").empty().append(wgzStr)}})}function comdify(n){var re=/\d{1,3}(?=(\d{3})+$)/g;var n1=n.replace(/^(\d+)((\.\d+)?)$/,function(s,s1,s2){return s1.replace(re,"$&,")+s2});return n1}function getMisneTop3ForThin(){var postData={};postData.audTrm=$("#audTrm").val();postData.prvdIds=$("#prvdIds").val();postData.ctyIds=$("#ctyIds").val();postData.attrName=$("#attrName").val();postData.focusCd=$("#focusCds").val();$.ajax({url:$.fn.eapurl()+"/yjk/getMisneTop3ForThin",dataType:"json",data:postData,success:function(data){var columns=data.body.columns;var zfStr="";$.each(columns,function(idx,obj){zfStr+="<p>"+obj.focusTh+"  <span>"+formatCurrency(obj.errorCount,true);if(obj.flag<0){zfStr+='<img src="/cmca/resource/images/youjiaka/down.png" alt="" class="down">'}else{zfStr+='<img src="/cmca/resource/images/youjiaka/top.png" alt="" class="top">'}zfStr+="</span>  </p>"});$("#gzsx").empty().append(zfStr)}})}function drawPrvdTable(focusCd){$("#currentPrvd").val(null);$("#currentCty").val(null);$("#focusCds").val(focusCd);var postData={audTrm:$("#audTrm").val(),prvdIds:$("#prvdIds").val(),ctyIds:$("#ctyIds").val(),focusCds:$("#focusCds").val(),orderField:$("#attrName").val()+"desc"};if(postData.ctyIds!=null&&postData.ctyIds!=""){drawCtyTable();$(".yangka_modal").show();return}jQuery("#TableScroll").html("<table id='table_scroll'></table>");var mydata="";$.ajax({url:"/cmca/yjk/getProvDetailData",dataType:"json",data:postData,success:function(data){var w=parseInt($(".table_modal").width())-6;
mydata=data.body;$("#table_scroll").jqGrid({data:mydata,datatype:"local",colNames:["序号","省公司","cntArea1","地市公司<br>数量","数量","数量占比（%）","金额(元)","金额占比（%）","","数量占比 ","金额占比","totalNum","tolAmt"],colModel:[{name:"RN",index:"RN",sortable:false,width:w*0.086},{name:"regionName",index:"regionName",sortable:false},{name:"cntArea",index:"cntArea1",sortable:false,hidden:true},{name:"cntArea",index:"cntArea",sortable:false,width:w*0.1,formatter:function(cellvalue,options,rowObject){var textDeco="";if(rowObject.prvdId==undefined){textDeco='style="text-decoration: none;"'}if(rowObject.errQty==0&&rowObject.errAmt==0){return rowObject.cntArea}return"<a onclick=\"drawCtyTable('"+rowObject.prvdId+"')\""+textDeco+">"+rowObject.cntArea+"</a>"},align:"center"},{name:"errQty",index:"errQty",formatter:"integer",formatoptions:{thousandsSeparator:","},sorttype:"integer",sortable:true,align:"right"},{name:"qtyPercent_formatter",index:"qtyPercent",sortable:true,sorttype:"float",align:"right"},{name:"errAmt",index:"errAmt",formatter:"integer",formatoptions:{thousandsSeparator:","},sorttype:"integer",sortable:true,align:"right"},{name:"errPercent_formatter",index:"errPercent",sortable:true,sorttype:"float",align:"right"},{name:"prvdId",index:"prvdId",hidden:true},{name:"qtyPercent",index:"qtyPercent1",sortable:true,sorttype:"float",hidden:true},{name:"errPercent",index:"errPercent1",sortable:true,sorttype:"float",hidden:true},{name:"totalNum",index:"totalNum",sortable:false,hidden:true},{name:"tolAmt",index:"tolAmt",sortable:false,hidden:true}],rowNum:31,footerrow:true,mtype:"post",viewrecords:true,scroll:true,width:w,height:"auto",rowheight:100,scrollOffset:1,jsonReader:{root:"body",repeatitems:false},onSortCol:function(index,colindex,sortorder){if(colindex==4){postData.orderField="errQty"}if(colindex==11){postData.orderField="qtyPercent"}if(colindex==6){postData.orderField="errAmt"}if(colindex==12){postData.orderField="errPercent"}postData.orderField=postData.orderField+sortorder;$("#table_box table thead tr[class='ui-jqgrid-labels jqg-third-row-header'] th").each(function(){if($(this).attr("id").indexOf("_errAmt")!=-1||$(this).attr("id").indexOf("_errPercent")!=-1||$(this).attr("id").indexOf("_qtyPercent")!=-1||$(this).attr("id").indexOf("_errQty")!=-1){$(this).find("span[class='s-ico']").attr("style","")}})},postData:postData,gridComplete:function(){var rowNum=$(this).jqGrid("getGridParam","records");if(rowNum>0){$("#nodata").hide();$(".ui-jqgrid-sdiv").show();var cntArea1=$(this).getCol("cntArea1",false,"sum");var totalNum=$(this).getCol("totalNum",false,"sum");var tolAmt=$(this).getCol("tolAmt",false,"sum");var cntArea=$(this).getCol("cntArea",false,"sum");var errQty=$(this).getCol("errQty",false,"sum");var errAmt=$(this).getCol("errAmt",false,"sum");var qtyPercent=errQty*100/totalNum;var errPercent=errAmt*100/tolAmt;$(this).footerData("set",{"regionName":"合计","cntArea":cntArea1,"totalNum":totalNum,"tolAmt":tolAmt,"cntArea":cntArea,"errQty":errQty,"qtyPercent_formatter":qtyPercent.toFixed(2)+"%","errAmt":errAmt,"errPercent_formatter":errPercent.toFixed(2)+"%"})}else{$("#nodata").show()}$(".yangka_modal").show();$(".yangka_modal .sheng").fadeIn()},});$("#table_box table thead th").each(function(){if($(this).attr("id").indexOf("_errAmt")!=-1||$(this).attr("id").indexOf("_errPercent")!=-1||$(this).attr("id").indexOf("_qtyPercent")!=-1||$(this).attr("id").indexOf("_errQty")!=-1){$(this).find("span[class='s-ico']").attr("style","")}});$("#TableScroll").find(".ui-jqgrid-bdiv").css("overflow","hidden");$("#TableScroll").find(".ui-jqgrid-bdiv").children("div").css("height","100%");jQuery("#table_scroll").jqGrid("setGroupHeaders",{useColSpanStyle:true,groupHeaders:[{startColumnName:"errQty",numberOfColumns:2,align:"center",titleText:"<em>违规有价卡数量</em>"},{startColumnName:"errAmt",numberOfColumns:2,align:"center",titleText:"违规有价卡金额"}]})}})}function drawCtyTable(v){$("#currentPrvd").val(v);$("#currentCty").val(null);var postData={audTrm:$("#audTrm").val(),prvdIds:$("#prvdIds").val(),ctyIds:$("#ctyIds").val(),focusCds:$("#focusCds").val(),orderField:$("#attrName").val()+"desc"};$(".yangka_modal .table_modal.dishi .back").hide();if($("#currentPrvd").val()!=null&&$("#currentPrvd").val()!=""){postData.prvdIds=$("#currentPrvd").val();postData.ctyIds="10000";$(".yangka_modal .table_modal.dishi .back").fadeIn()}var w=parseInt($(".table_modal").width())-6;$("#table_scroll1").remove();$("#TableScroll1").html("<table id='table_scroll1'></table>");var mydata="";$.ajax({url:"/cmca/yjk/getCityDetailData",dataType:"json",data:postData,success:function(data){mydata=data.body;$("#table_scroll1").jqGrid({rowNum:31,colNames:["序号","省公司","地市公司","数量","数量占比（%）","金额（元）","金额占比（%）","","数量占比 ","金额占比","totalNum","tolAmt"],colModel:[{name:"RN",index:"RN",sortable:false,width:w*0.086},{name:"prvdName",index:"prvdName",sortable:false},{name:"regionName",index:"regionName",sortable:false},{name:"errQty",index:"errQty",formatter:"integer",formatoptions:{thousandsSeparator:","},align:"right"},{name:"qtyPercent_formatter",index:"qtyPercent",sortable:true,sorttype:"float",align:"right"},{name:"errAmt",index:"errAmt",formatter:"integer",formatoptions:{thousandsSeparator:","},align:"right"},{name:"errPercent_formatter",index:"errPercent",sortable:true,sorttype:"float",align:"right"},{name:"ctyId",index:"ctyId",hidden:true,sortable:false},{name:"qtyPercent",index:"qtyPercent1",sortable:true,sorttype:"float",hidden:true},{name:"errPercent",index:"errPercent1",sortable:true,sorttype:"float",hidden:true},{name:"totalNum",index:"totalNum",sortable:false,hidden:true},{name:"tolAmt",index:"tolAmt",sortable:false,hidden:true}],data:mydata,datatype:"local",footerrow:true,rowheight:100,viewrecords:true,scroll:true,width:w,height:"auto",scrollOffset:1,jsonReader:{root:"body",repeatitems:false},gridComplete:function(){var rowNum=$(this).jqGrid("getGridParam","records");
if(rowNum>0){$(".ui-jqgrid-sdiv").show();var totalNum=$(this).getCol("totalNum",false,"sum");var tolAmt=$(this).getCol("tolAmt",false,"sum");var errQty=$(this).getCol("errQty",false,"sum");var errAmt=$(this).getCol("errAmt",false,"sum");var qtyPercent=errQty*100/totalNum;var errPercent=errAmt*100/tolAmt;$(this).footerData("set",{"regionName":"合计","totalNum":totalNum,"tolAmt":tolAmt,"errQty":errQty,"qtyPercent_formatter":qtyPercent.toFixed(2)+"%","errAmt":errAmt,"errPercent_formatter":errPercent.toFixed(2)+"%"})}$(this).addClass("active").siblings().removeClass("active");$(".yangka_modal .table_modal.sheng").hide();$(".yangka_modal .table_modal.dishi").fadeIn()},onSortCol:function(index,colindex,sortorder){if(colindex==3){postData.orderField="errQty"}if(colindex==4){postData.orderField="qtyPercent"}if(colindex==5){postData.orderField="errAmt"}if(colindex==6){postData.orderField="errPercent"}postData.orderField=postData.orderField+sortorder;$("#table_scroll1").jqGrid("setGridParam",{postData:postData});$("#table_box1 table thead tr[class='ui-jqgrid-labels jqg-third-row-header'] th").each(function(){if($(this).attr("id").indexOf("_errAmt")!=-1||$(this).attr("id").indexOf("_errPercent")!=-1||$(this).attr("id").indexOf("_qtyPercent")!=-1||$(this).attr("id").indexOf("_errQty")!=-1){$(this).find("span[class='s-ico']").attr("style","")}})}});$("#TableScroll1").find(".ui-jqgrid-bdiv").css("overflow","hidden");$("#TableScroll1").find(".ui-jqgrid-bdiv").children("div").css("height","100%");jQuery("#table_scroll1").jqGrid("setGroupHeaders",{useColSpanStyle:true,groupHeaders:[{startColumnName:"errQty",numberOfColumns:2,align:"center",titleText:"<em>违规有价卡数量</em>"},{startColumnName:"errAmt",numberOfColumns:2,align:"center",titleText:"违规有价卡金额"}]})}})}function drawAuditReport(){var postData={};postData.audTrm=$("#audTrm").val();if($.trim($("#isQuanguo").val())=="true"){postData.prvdId=10000}else{postData.prvdId=$("#prvdIds").val()}$.ajax({url:$.fn.eapurl()+"/yjk/getAuditReportData",dataType:"json",data:postData,success:function(data){var totalInfo=data.body.totalInfo;$("#auditCompany").html(totalInfo.auditCompany);$("#auditMonth").html(totalInfo.auditMonth);$("#auditRegion").html(totalInfo.auditRegion);var auditDiscovery="全网"+totalInfo.startMonth+"有价卡各环节状态发生变更的累计"+((typeof(totalInfo.totalQty)=="undefined")?"0":totalInfo.totalQty)+"万张，金额"+((typeof(totalInfo.totalAmt)=="undefined")?"0":totalInfo.totalAmt)+"万元；<br>审计识别出违规数量"+((typeof(totalInfo.errQty)=="undefined")?"0":totalInfo.errQty)+"万张，占比"+((typeof(totalInfo.cur_qtyPercent)=="undefined")?"0.00%":totalInfo.cur_qtyPercent)+"%，比上月"+((typeof(totalInfo.abs_fbQtyPercent)=="undefined")?"0":totalInfo.abs_fbQtyPercent)+"个百分点；<br>违规金额"+((typeof(totalInfo.errAmt)=="undefined")?"0":totalInfo.errAmt)+"万元，占比"+((typeof(totalInfo.qtyChnlPercent)=="undefined")?"0.00%":totalInfo.qtyChnlPercent)+"，比上月"+((typeof(totalInfo.abs_fbAmtPercent)=="undefined")?"下降0":totalInfo.abs_fbAmtPercent)+"个百分点。<br>";$("#auditDiscovery").html(auditDiscovery);var topTable=data.body.tableInfo;var topTableHtml="";var hjErrQty=0;var hjTotalQty=0;var hjErrChnlQty=0;var hjTotalChnlQty=0;var hjQtyPercent="";var hjQtyChnlPercent="";$.each(topTable,function(idx,obj){topTableHtml+="<tr>";topTableHtml+="<td>"+obj.focusName+"</td>";topTableHtml+="<td>"+formatCurrency(obj.errQty,false)+"</td>";topTableHtml+="<td>"+changeTwoDecimal(obj.qtyPercent)+"%</td>";topTableHtml+="<td>"+formatCurrency(obj.errAmt,true)+"</td>";topTableHtml+="<td>"+changeTwoDecimal(obj.errPercent)+"%</td>";topTableHtml+="</tr>"});$("#yjkTableAuditReport").html(topTableHtml)}})}function drawCrmVcDif(){var postData={};postData.audTrm=$("#audTrm").val();if($.trim($("#isQuanguo").val())=="true"){postData.prvdIds=10000;postData.prvdIdFlag="1"}else{postData.prvdIds=$("#prvdIds").val();postData.prvdIdFlag="0"}$.ajax({url:"/cmca/yjk/getCrmVcDiftData",dataType:"json",data:postData,success:function(data){var vc_num=data.body.vc_num;var all_num=data.body.all_num;var crm_num=data.body.crm_num;if(vc_num.length==0){vc_num=[0,0,0,0]}if(all_num.length==0){all_num=[0,0,0,0]}if(crm_num.length==0){crm_num=[0,0,0,0]}Highcharts.setOptions({colors:["#d76363","#2ca890","#ffae00"]});$("#vc_crm_dif").highcharts({chart:{type:"bar",backgroundColor:"transparent"},title:{text:""},xAxis:{gridLineColor:"#6d7484",gridLineWidth:1,categories:["生成","激活","充值","锁定"],labels:{style:{color:"#FFFFFF",fontSize:"12px",fontFamily:"微软雅黑"}}},yAxis:{lineColor:"#6d7484",lineWidth:1,min:0,title:{text:""},labels:{format:"{value} %",style:{color:"#FFFFFF",fontSize:"12px",fontFamily:"微软雅黑"}}},legend:{reversed:true,itemStyle:{color:"#FFFFFF",fontSize:"12px",cursor:"default",fontFamily:"微软雅黑"},itemHoverStyle:{color:"#FFFFFF"},},plotOptions:{bar:{borderWidth:0},series:{stacking:"percent",events:{legendItemClick:function(event){return false}}}},tooltip:{formatter:function(){var name=this.series.name;var stat=this.x;var qty=formatCurrency(this.y,false);var per=this.percentage.toFixed(2);return'<tspan style="font-size: 10px" style="color:'+this.series.color+'">'+stat+"</tspan><br/>"+'<tspan style="color:'+this.series.color+'">●</tspan>'+'<tspan style="color:'+this.series.color+'"> '+name+":</tspan><br/>"+'<tspan style="color:'+this.series.color+'">数量：'+qty+"   占比："+per+"%"+"</tspan><br/>"
}},series:[{name:"VC存在但CRM不存在",data:vc_num},{name:"CRM和VC均存在",data:all_num},{name:"CRM存在但VC不存在",data:crm_num}]})}})};